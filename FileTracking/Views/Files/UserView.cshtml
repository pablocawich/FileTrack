
@model IEnumerable<FileTracking.Models.File>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
<div class="row">
    <div class="col-lg-12">
        <h2 class="page-header">Files</h2>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="row">
    <!--Content goes here b -->

    <table id="userFileTable" class="table table-striped table-bordered table-hover" style="width:100%">
        <thead>
            <tr>
                <th> File Number</th>
                <th>Name</th>
                <th>City/Town/Village</th>
                <th>District</th>
                <th>Volumes</th>
                <th>Date Added</th>
                <th>Actions</th>

            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div class="modal fade" id="myModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content" id="modelContent">
            </div>
        </div>
    </div>

</div>

@section scripts{
    <script>
        $(document).ready(function () {
            $("#userFileTable").DataTable({
                "ajax": {
                    "url": "/Files/GetFiles",
                    "data": "POST",
                    "datatype": "json"
                },
                "columns": [
                    {
                        "data": "FileNumber", "name": "FileNumber",
                        render: function(data, type, file) {

                            return "<span data-url='"+file.Id+" 'class='glyphicon glyphicon-file btn btn-xs btn-primary spanModal'>" + file.FileNumber+"</span>";

                        }
                    },
                    {
                        "data": "FirstName", "name": "FirstName",
                        render: function (data, type, file) {
                            var mName = file.MiddleName;
                            if (file.MiddleName == null)
                                mName = "";

                            return file.FirstName + " " + mName + " " + file.LastName;
                        }
                    },
                   
                    { "data": "CityOrTown", "name": "CityOrTown" },
                    { "data": "Districts.District", "name": "Districts.District" },
                    { "data": "Volume", "name": "Volume" },
                    {
                        "data": "DateCreated",
                        "name": "DateCreated",
                        "render": function (value) {
                            return getDateString(value);
                        }
                    },
                    {
                        data: "Id",

                        "render": function (data, type, vol) {
                            
                            var buttonRequest = "<button class='btn btn-warning btn-sm js-requestFile' data-request-name='" + vol.FirstName + "' data-request-file-id='" + data + "'>Request</button>";
                            return buttonRequest;
                        }
                    }
                ],
                "serverSide": "true",
                "order": [0, "asc"],
                "processing": "true",
                "language": {
                    "processing": "Processing Files... Kindly hold"
                }
            });

            //-------------------------End dataTables implementation ---------------------------------------
            function getDateString(date) {
                var dateObj = new Date(parseInt(date.substr(6)));
                return dateObj.toDateString();
            }
            //opens modal that displays file information for a specif file
            $("#userFileTable").on("click",
                ".spanModal",
                function() {
                    var id = $(this).attr("data-url");
                    var url = "/Files/FileDetails/" + id;
                    // alert(url);

                    $('#modelContent').load(url);
                    $('#myModal').modal('show');
                });
            //sends user to the volumes page to be able specify and request a volume
            $("#userFileTable").on("click", ".js-requestFile", function () {
                var button = $(this);
                var name = button.attr("data-request-name");
                bootbox.confirm("You are to request a file for "+name.toUpperCase()+". To request this file you need to specify a volume. Do you wish to proceed", function (result) {
                    if (result) {
                        window.location.href = "/FileVolumes/RequestFile/" + button.attr("data-request-file-id");
                    }
                });
            });

        });
    </script>
}
